sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";return e.extend("nfaformui.ext.controller.Vendordataobjpage",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel();console.log("oModel",e)},routing:{onAfterBinding:async function(e){debugger;var t=window.location.href;var a=t.match(/NfaDetailsToNfaVendorData\(([^)]+)\)/);let n="";let o="";let r="";if(a&&a[1]){var s=a[1].split(",");s.forEach(function(e){var t=e.split("=");var a=t[0].trim();var s=t[1].trim();if(s.startsWith("'")&&s.endsWith("'")){s=s.slice(1,-1)}if(a==="NfaNumber")n=s;if(a==="ProposedVendorCode")o=s;if(a==="round")r=s})}console.log("NfaNumber:",n);console.log("ProposedVendorCode:",o);console.log("round:",r);let i="getVendorData";let l=this.getView().getModel().bindContext(`/${i}(...)`);l.setParameter("NfaNumber",n);l.setParameter("ProposedVendorCode",o);l.setParameter("round",r);debugger;await l.execute();var c=l.getBoundContext().getValue();var u=JSON.parse(c.value);console.log(u);var d=u[0].HrClearanceCertificates;var f=u[0].Insurance;var g=u[0].JobClearanceCertificates;function m(e){if(!e)return"";var t=e.split(".");return t.length>1?t.pop().toLowerCase():""}var p=m(d);var b=m(f);var w=m(g);var N="getHrJob";let h=this.getView().getModel().bindContext(`/${N}(...)`);var y="getJobClearanceCertificate";let D=this.getView().getModel().bindContext(`/${y}(...)`);var C="getInsurance";let E=this.getView().getModel().bindContext(`/${C}(...)`);debugger;let V=sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage--fe::FormContainer::TermsPenaltiesLegalConditions");V.getFormElements().slice().forEach(e=>{const t=e.data("certificateType");if(t==="HR"||t==="Job"||t==="Insurance"){V.removeFormElement(e)}});let v=d?new sap.m.Link({text:d,icon:"sap-icon://show",press:A}):new sap.m.Text({text:"-"});let x=g?new sap.m.Link({text:g,icon:"sap-icon://show",press:L}):new sap.m.Text({text:"-"});let P=f?new sap.m.Link({text:f,icon:"sap-icon://show",press:j}):new sap.m.Text({text:"-"});let I=new sap.ui.layout.form.FormElement({label:new sap.m.Label({text:"HR Clearance"}),fields:[v],customData:[new sap.ui.core.CustomData({key:"certificateType",value:"HR"})]});let B=new sap.ui.layout.form.FormElement({label:new sap.m.Label({text:"Job Clearance"}),fields:[x],customData:[new sap.ui.core.CustomData({key:"certificateType",value:"Job"})]});let T=new sap.ui.layout.form.FormElement({label:new sap.m.Label({text:"Insurance"}),fields:[P],customData:[new sap.ui.core.CustomData({key:"certificateType",value:"Insurance"})]});[I,B,T].forEach(e=>V.addFormElement(e));async function A(e){sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(true);const t=window.location.href;const a=(t.match(/NfaNumber='([^']+)'/)||[])[1]||null;const n=(t.match(/ProposedVendorCode='([^']+)'/)||[])[1]||null;h.setParameter("NfaNumber",a);h.setParameter("invitationId",n);await h.execute();debugger;const o=h.getBoundContext();const r=o.getValue();const s=r.value;function i(e,t="application/pdf"){const a=512;const n=atob(e);const o=[];for(let e=0;e<n.length;e+=a){const t=n.slice(e,e+a);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}const s=new Uint8Array(r);o.push(s)}return new Blob(o,{type:t})}const l=i(s);const c=URL.createObjectURL(l);sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(false);window.open(c,"_blank")}async function L(e){sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(true);debugger;const t=window.location.href;const a=(t.match(/NfaNumber='([^']+)'/)||[])[1]||null;const n=(t.match(/ProposedVendorCode='([^']+)'/)||[])[1]||null;D.setParameter("NfaNumber",a);D.setParameter("invitationId",n);await D.execute();const o=D.getBoundContext();const r=o.getValue();debugger;const s=r.value;function i(e,t="application/pdf"){const a=512;const n=atob(e);const o=[];for(let e=0;e<n.length;e+=a){const t=n.slice(e,e+a);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}const s=new Uint8Array(r);o.push(s)}return new Blob(o,{type:t})}const l=i(s);const c=URL.createObjectURL(l);sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(false);window.open(c,"_blank")}async function j(e){debugger;sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(true);debugger;const t=window.location.href;const a=(t.match(/NfaNumber='([^']+)'/)||[])[1]||null;const n=(t.match(/ProposedVendorCode='([^']+)'/)||[])[1]||null;E.setParameter("NfaNumber",a);E.setParameter("invitationId",n);await E.execute();const o=E.getBoundContext();const r=o.getValue();debugger;const s=r.value;function i(e,t="application/pdf"){const a=512;const n=atob(e);const o=[];for(let e=0;e<n.length;e+=a){const t=n.slice(e,e+a);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}const s=new Uint8Array(r);o.push(s)}return new Blob(o,{type:t})}const l=i(s);const c=URL.createObjectURL(l);sap.ui.core.Element.getElementById("nfaformui::NfaDetails_NfaDetailsToNfaVendorDataObjectPage").setBusy(false);window.open(c,"_blank")}e.requestObject().then(e=>{debugger;if(!e)return;if(e.NfaVendorDataToNfaDetails.Status=="Need For Clarification"||e.NfaVendorDataToNfaDetails.Status=="New"){this.getView().byId("fe::StandardAction::Edit").setVisible(true);this.getView().byId("fe::StandardAction::Edit").setEnabled(true)}else{this.getView().getController().getExtensionAPI().getEditFlow().setEditMode("Display");this.getView().byId("fe::StandardAction::Edit").setVisible(false);this.getView().byId("fe::StandardAction::Edit").setEnabled(false)}})}}}})});
//# sourceMappingURL=Vendordataobjpage.controller.js.map